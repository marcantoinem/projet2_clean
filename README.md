This is just a little rewrite in rust of an horrible inefficient python code.